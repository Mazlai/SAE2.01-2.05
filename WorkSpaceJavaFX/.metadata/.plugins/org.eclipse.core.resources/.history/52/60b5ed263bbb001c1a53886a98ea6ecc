package gestclub.view;

import java.net.URL;
import java.util.List;
import java.util.Optional;
import java.util.ResourceBundle;

import gestclub.GestClubApp;
import gestclub.model.Membre;
import javafx.beans.property.ListProperty;
import javafx.collections.ObservableList;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.ButtonType;
import javafx.scene.control.ListView;
import javafx.scene.control.SelectionMode;
import javafx.scene.control.Alert.AlertType;

public class ListeMembresController implements Initializable {
	
	@FXML
	private ListView<Membre> listViewMembres;
	@FXML
	private Button butEditer;
	@FXML
	private Button butSupprimer;
	
	private GestClubApp getClubApp;

	public void setGetClubApp(GestClubApp getClubApp) {
		this.getClubApp = getClubApp;
	}
	@Override
	public void initialize(URL location, ResourceBundle resources) {
		listViewMembres.setOnMouseClicked(event -> listClick());
	}
	
	public void setListeMembre(ListProperty<Membre> liste) {
		this.listViewMembres.itemsProperty().bindBidirectional(liste);
		/*for (Membre membre : liste) {
			this.listViewMembres.getItems().add(membre);
		}*/
	}

	@FXML
	private void actionNouveau() {
		Membre m = this.getClubApp.showSaisieMembre(null);
		if (m!=null) {
			this.listViewMembres.getItems().add(m);
		}
	}
	
	public void listClick() {
		if(listViewMembres.getSelectionModel().getSelectedItem() == null) {
			butEditer.setDisable(true);
			butSupprimer.setDisable(true);
		} else {
			butEditer.setDisable(false);
			butSupprimer.setDisable(false);
		}
	}
	
	@FXML
	private void actionEditer() {
		Membre m = this.getClubApp.showSaisieMembre(listViewMembres.getSelectionModel().getSelectedItem());
		if (m!=null) {
			this.listViewMembres.getItems().remove(this.listViewMembres.getSelectionModel().getSelectedItem());
			this.listViewMembres.getItems().add(this.listViewMembres.getSelectionModel().getSelectedIndex(), m);
		}			
	}		
		
	@FXML
	private void actionSupprimer() {
		
		Alert infoBox = new Alert(AlertType.CONFIRMATION);
		infoBox.setTitle("Confirmation");
		infoBox.setHeaderText("Voulez-vous vraiment supprimer " + this.listViewMembres.getSelectionModel().getSelectedItem().getNom() + " " + this.listViewMembres.getSelectionModel().getSelectedItem().getPrenom() + " ?");

		Optional<ButtonType> reponse = infoBox.showAndWait();
		
		if(reponse.orElse(null) == ButtonType.OK) {
			this.listViewMembres.getItems().remove(this.listViewMembres.getSelectionModel().getSelectedItem());
		} else {
			infoBox.close();
		}
		
	}
	

}
